# ***************************************************************
# ** 研究
# ** R主程序
# ***************************************************************
####                文档注释                        #####
# 这里与人大王非老师的顺序有点不同
# 他在合并数据后:完善变量标签、单变量清洗、多变量清洗、定义研究样本、变量调整 
# 我是在合并数据后:
# 没有完善变量标签,因为大部分是已存在)、单变量清洗(特殊值转缺失值)、(定义研究样本放在之后)、变量调整

# ***************************************************************
#####               Setting                 ·       #####
# ***************************************************************

# Mac
path <- "/Users/zhouzhengqing/Desktop/Paper01"
# mplus_path <- "/Users/zhouzhengqing/Desktop/chapter4_Data_tidy"

# 需要预先在生成子文件夹:data, refs, out
SourceData <- paste0(path, "/SourceData") # 原始数据文件夹
WorkData <- paste0(path, "/WorkData") # 操作数据文件夹
Refs <- paste0(path , "/Refs")     # 参考文献
Output  <- paste0(path , "/Output" )     # 结果:图形和表格

# ***************************************************************
# ****    提取数据,配置工作路径  
# ***************************************************************
library(haven)
library(here)
read_dta(paste0(SourceData , "/eass.dta")) ->  dta
as_tibble(dta)  -> dta
nrow(dta)   # 看看有多少觀察值(多少行)--10137

# 使用`sjPlot::view_df()`來製作資料的次數分配報表,html
sjPlot::view_df(dta)



# ***************************************************************
##### 第0階段       Data_familiar                   ##### 
# ***************************************************************

# ***************************************************************

##### 第1階段       Data_cleaning                   #####
# ***************************************************************

# ***************************************************************
#####   1.1.          提取关键变量与整理全体数据    #####
# ***************************************************************

# 常规变量设置
vars_id <- c("CASEID","V3","V1","V2")
# 因变量系列
vars_y <- c("V4","V12","V14")
# 自变量系列
vars_x <- c("V59","V60","V61","V62","V63","V64","V65","V67")
# 中介变量系列
vars_m <- c("V29","V32")
# 协变量系列
vars_c <- c("SEX","AGE","MARITAL","MAINSTAT","URBRURAL",
            "DEGREE","TTLCNUM","V18","JP_RINC","TW_RINC",
            "CN_RINC","KR_RINC","JP_HINC","TW_HINC","CN_HINC","KR_HINC","EMPREL")
# 协变量系列
vars_spec <- c("BMI","RLTVHINC","HMSP","TOPBOT")

# 选取变量
vars_select  <- c(vars_id, vars_y, vars_x, vars_m, vars_c ,vars_spec)

dta %>% dplyr::select(any_of(vars_select)) %>% glimpse() -> dta_selected
dta_selected  %>% get_var_label()

# library(sjmisc)
# 以瀏覽器開啟所有變數的資訊(html檔)
# descr(dta_selected, vars_select, out="browser") 


##### ***************************************************************
#####   1.2.          数据纵向合并(无)            ##### 
##### ***************************************************************
# 无
# ***************************************************************
#####   1.3.          数据清洗                      #####                    
# **===============================================**

# ***************************************************************
#####     1.3.1.        因变量                      #####
# ***************************************************************


# ***************************************************************
#####     1.3.2.        自变量                      ##### 
# ***************************************************************


# ***************************************************************
#####     1.3.3.        中介变量                    ##### 
# ***************************************************************


# ***************************************************************
#####     1.3.3.        控制变量(分类|因子)       ##### 
# ***************************************************************

# ***************************************************************
#####     1.3.4.        协变量(通常是连续)        ##### 
# ***************************************************************

# ***************************************************************

